---
import '../styles/main.sass';

const baseUrl = import.meta.env.BASE_URL;

// Obtener la URL actual para determinar la página activa
const currentPath = Astro.url.pathname;

const isActive = (path: string) => {
  // Para la página principal
  if (path === baseUrl || path === '/') {
    return currentPath === baseUrl || currentPath === '/' || currentPath === '';
  }
  
  // Para otras páginas
  return currentPath.includes(path);
};

// Función 1: Limpiar la dirección
function cleanPath(path: string): string {
  return path
    .replace(/\/index\.html$/, '') 
    .replace(/\/$/, '')             
    .replace(/\.html$/, '') + '/';       
}

// Función 2: Obtener meta data basado en la página limpia
function getMetaByPage(pageName: string): { title: string; description: string } {
  switch (pageName) {
    case '':
    case '/':
      return {
        title: "🪶 Talleres de Teatro y Educación Emocional en Colegios de Sevilla",
        description: "🎭 Talleres de teatro para Infantil y Primaria que fomentan creatividad, empatía y gestión emocional - Transforma tu aula con pasión"
      };
    case '/about':
      return {
        title: "✨ 15 años de experiencia · Corazón, Emoción y Alma 🪽",
        description: "💡 Soy María Pozo Távora, profesora de teatro con más de 15 años de experiencia 🎭 · Especialista en unir Teatro y Educación Emocional"
      };
    case '/talleres':
      return {
        title: "Teatro en el Aula 🎭 Cambio de perspectiva",
        description: "🌱 Talleres de teatro 🎭 y actividades complementarias para colegios 🏫 · Creatividad, confianza y gestión emocional para cada edad 🌱."
      };
    case '/beneficios':
      return {
        title: "💛 Beneficios del Teatro en Infantil y Primaria",
        description: "Comprueba cómo el teatro en el aula potencia la autoestima, la empatía, la cohesión grupal y mejora la comunicación. Resultados reales para Infantil y Primaria ✨"
      };
    case '/trayectoria':
      return {
        title: "Trayectoria profesional en Teatro",
        description: "✍🏼 15 años enseñando, colaborando con colegios · Logros y proyectos destacados · Conoce mi recorrido en teatro y educación emocional🫂"
      };
    default:
      return {
        title: "María Pozo · Teatro y Educación Emocional",
        description: "María Pozo Távora - Descubre mis talleres de teatro para grupos en edad escolar."
      };
  }
}

// Usar las dos funciones juntas
const cleanedPath = cleanPath(currentPath);
const { title: pageTitle, description: pageDescription } = getMetaByPage(cleanedPath);
---
<html lang="es">
  <head>
    <meta charset="utf-8" />
    
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-WF3KX2NJ');</script>
    <!-- End Google Tag Manager -->
    <title>{pageTitle}</title>
    <link rel="icon" href="/favicon.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
 
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content={pageDescription} />
    <meta name="keywords" content="María Pozo, educación primaria, educación secundaria teatro, educación emocional, talleres de teatro, aprendizaje emocional, recursos educativos" />
    <meta name="author" content="Santiago Pozo" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={`https://mariapozotavora.com${cleanedPath}`} />
    <meta property="og:title" content={pageTitle} />
    <meta property="og:description" content={pageDescription} />
    <meta property="og:image" content={`${baseUrl}images/og-image.jpg`} />
    <meta property="og:site_name" content="María Pozo · Teatro y Educación Emocional" />
    <meta property="og:locale" content="es_ES" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={`https://mariapozotavora.com${cleanedPath}`} />
    <meta property="twitter:title" content={pageTitle} />
    <meta property="twitter:description" content={pageDescription} />
    <meta property="twitter:image" content={`${baseUrl}images/og-image.jpg`} />

    <!-- LinkedIn -->
    <meta property="linkedin:card" content="summary_large_image" />
    <meta property="linkedin:url" content={`https://mariapozotavora.com${cleanedPath}`} />
    <meta property="linkedin:title" content={pageTitle} />
    <meta property="linkedin:description" content={pageDescription} />
    <meta property="linkedin:image" content={`${baseUrl}images/og-image.jpg`} />

    <!-- Canonical URL -->
    <link rel="canonical" href={`https://mariapozotavora.com${cleanedPath}`} />

    <!-- Favicon adicional -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <meta name="theme-color" content="#F9CD1D" />
    </head> 
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WF3KX2NJ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <header>
      <nav>
        <a href={baseUrl} class={isActive(baseUrl) ? 'active' : ''}>Inicio</a>
        <a href={`${baseUrl}about/`} class={isActive('about') ? 'active' : ''}>Sobre mí</a>
        <a href={`${baseUrl}talleres/`} class={isActive('talleres') ? 'active' : ''}>Talleres</a>
        <a href={`${baseUrl}beneficios/`} class={isActive('beneficios') ? 'active' : ''}>Beneficios</a>
        <a href={`${baseUrl}trayectoria/`} class={isActive('trayectoria') ? 'active' : ''}>Trayectoria</a>
      </nav>
      <section class="landing-hero">
    <div class="hero-content">
        <div class="hero-text">
            <h1>Talleres de Teatro y Educación Emocional en Colegios</h1>
            <p class="hero-subtitle">El Teatro como herramienta educativa en Infantil y Primaria.</p>
        </div>
        
        <div class="hero-image">
            <img src={`${baseUrl}images/photo.png`} alt="María Pozo - Profesora de teatro y educación emocional" />
        </div>
    </div>
</section>
    </header>

    <!-- Social bar -->
    <aside class="social-bar">
      <a href="https://www.instagram.com/maria_teatro_emocionante/" target="_blank" rel="noopener noreferrer" aria-label="Instagram de María Pozo">
        <img src={`${baseUrl}icons/social/instagram.svg`} alt="Instagram" />
      </a>
      <a href="mailto:mariaptavora@gmail.com" aria-label="Enviar email a María Pozo">
        <img src={`${baseUrl}icons/social/email.svg`} alt="Email" />
      </a>
      <a href="https://www.linkedin.com/in/mariapozotavora/" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn de María Pozo">
        <img src={`${baseUrl}icons/social/linkedin.svg`} alt="LinkedIn" />
      </a>
    </aside>

    <main>
      <slot />
    </main>

    
    <!-- Botón volver arriba -->
    <button id="scroll-to-top" class="scroll-to-top" aria-label="Volver arriba">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 4L6 10H10V20H14V10H18L12 4Z" fill="currentColor"/>
      </svg>
    </button>


    <!-- Formulario de contacto desplegable -->
<div id="contact-overlay" class="contact-overlay">
  <div class="contact-form-container">
    <button id="close-form" class="close-form" aria-label="Cerrar formulario">×</button>
    
    <header class="form-header">
      <h2>Contacta conmigo</h2>
      <p>Cuéntame sobre tu proyecto y te responderé lo antes posible</p>
    </header>
    
    <!-- Reemplaza la sección del formulario actual -->
<form id="contact-form" action="https://formsubmit.co/mariaptavora@gmail.com" method="POST">
  <!-- Configuración de FormSubmit -->
  <input type="hidden" name="_subject" value="Nuevo mensaje desde mariapozotavora.com">
  <input type="hidden" name="_captcha" value="false">
  <input type="hidden" name="_template" value="table">
  <input type="hidden" name="_next" value="https://mariapozotavora.com/#form-sent">
  
  <div class="form-group">
    <label for="nombre">Nombre completo *</label>
    <input 
      type="text" 
      id="nombre" 
      name="nombre" 
      required 
      placeholder="Tu nombre y apellidos"
    >
    <span class="error-message"></span>
  </div>
  
  <div class="form-group">
    <label for="email">Correo electrónico *</label>
    <input 
      type="email" 
      id="email" 
      name="email" 
      required 
      placeholder="tu@correo.com"
    >
    <span class="error-message"></span>
  </div>
  
  <div class="form-group">
    <label for="centro">Centro educativo *</label>
    <input 
      type="text" 
      id="centro" 
      name="centro" 
      required 
      placeholder="Nombre del colegio o centro"
    >
    <span class="error-message"></span>
  </div>
  
  <div class="form-group">
    <label for="mensaje">Mensaje *</label>
    <textarea 
      id="mensaje" 
      name="mensaje" 
      rows="4" 
      required 
      placeholder="Cuéntame quién eres y dame la información oportuna: edades, probables fechas, talleres..."
    ></textarea>
    <span class="error-message"></span>
  </div>
  
  <!-- Botón de envío añadido -->
  <button type="submit" class="submit-form-button">
    Enviar mensaje
  </button>
</form>
    
    <!-- Mensaje de confirmación -->
    <div id="success-message" class="success-message">
      <h3>✨ Mensaje enviado</h3>
      <p>Me pondré en contacto contigo lo antes posible.</p>
    </div>
  </div>
</div>

<!-- Botón de contacto (modificado) -->
<div class="cta-section">
  <button id="contact-button" class="cta-button">
    Contacta conmigo
  </button>
</div>

    <!-- Aviso de cookies -->
    <div id="cookie-banner" class="cookie-banner">
      <div class="cookie-content">
        <p>Esta web utiliza cookies para mejorar la experiencia del usuario. Al continuar navegando, aceptas su uso.</p>
        <button id="accept-cookies" class="cookie-button">Aceptar</button>
      </div>
    </div>
    <footer>
      <p>&copy; {new Date().getFullYear()} María Pozo Távora - Teatro y Educación Emocional</p>
      <p>Webmaster y desarrollo: <a href="https://santiago-pozo.com" target="_blank" rel="noopener noreferrer">Santiago Pozo</a></p>
    </footer>

    <script>
      // Script para el botón scroll to top
      const scrollToTopButton = document.getElementById('scroll-to-top');
      
      // Mostrar/ocultar el botón según el scroll
      window.addEventListener('scroll', () => {
        if (window.scrollY > 300) {
          scrollToTopButton?.classList.add('visible');
        } else {
          scrollToTopButton?.classList.remove('visible');
        }
      });
      
      // Funcionalidad de scroll suave al hacer click
      scrollToTopButton?.addEventListener('click', () => {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });

      // Script para el aviso de cookies
      document.addEventListener('DOMContentLoaded', function() {
        const cookieBanner = document.getElementById('cookie-banner');
        const acceptButton = document.getElementById('accept-cookies');
        
        // Verificar si las cookies ya fueron aceptadas
        const cookiesAccepted = localStorage.getItem('cookies-accepted');
        
        if (!cookiesAccepted) {
          // Mostrar el banner después de un pequeño delay
          setTimeout(() => {
            cookieBanner?.classList.add('visible');
          }, 1000);
        }
        
        // Manejar la aceptación de cookies
        acceptButton?.addEventListener('click', () => {
          // Guardar la aceptación en localStorage
          localStorage.setItem('cookies-accepted', 'true');
          
          // Ocultar el banner con animación
          cookieBanner?.classList.add('hidden');
          
          // Remover el elemento del DOM después de la animación
          setTimeout(() => {
            cookieBanner?.remove();
          }, 500);
        });
      });

      // Script para el formulario de contacto
      document.addEventListener('DOMContentLoaded', function() {
        const contactButton = document.getElementById('contact-button');
        const contactOverlay = document.getElementById('contact-overlay');
        const closeFormButton = document.getElementById('close-form');
        const successMessage = document.getElementById('success-message');
        const contactForm = document.getElementById('contact-form') as HTMLFormElement;

        // Mostrar el formulario al hacer clic en el botón de contacto
        contactButton?.addEventListener('click', () => {
          contactOverlay?.classList.add('visible');
        });

        // Cerrar el formulario al hacer clic en el botón de cerrar
        closeFormButton?.addEventListener('click', () => {
          contactOverlay?.classList.remove('visible');
        });

        // Manejar el envío del formulario
        contactForm?.addEventListener('submit', (event) => {
          event.preventDefault(); // Prevenir el envío normal del formulario
          
          // Validar y enviar el formulario usando FormSubmit
          const formData = new FormData(contactForm);
          const jsonData = Object.fromEntries(formData.entries());
          
          // Aquí puedes agregar más validaciones si es necesario
          
          // Enviar los datos a FormSubmit
          fetch(contactForm.action, {
            method: 'POST',
            body: JSON.stringify(jsonData),
            headers: {
              'Content-Type': 'application/json'
            }
          })
          .then(response => {
            if (response.ok) {
              // Mostrar mensaje de éxito
              contactForm?.reset();
              contactOverlay?.classList.remove('visible');
              successMessage?.classList.add('visible');
            } else {
              // Manejar errores de envío
              alert('Error al enviar el mensaje. Por favor, intenta nuevamente más tarde.');
            }
          })
          .catch(error => {
            console.error('Error:', error);
            alert('Error al enviar el mensaje. Por favor, intenta nuevamente más tarde.');
          });
        });
      });
    </script>
  </body>
</html>
